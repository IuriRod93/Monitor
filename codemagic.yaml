workflows:
  ios-workflow:
    name: iOS Build
    environment:
      xcode: latest
      cocoapods: default
    scripts:
      - name: Install Python and dependencies
        script: |
          python3 -m pip install --upgrade pip
          pip3 install briefcase toga-ios requests
      - name: Create iOS app
        script: |
          cd Spy-mobile
          python3 -m briefcase create iOS
      - name: Build iOS app
        script: |
          cd Spy-mobile
          python3 -m briefcase build iOS
      - name: Generate IPA manually
        script: |
          cd Spy-mobile/build/calcme/ios
          # Create IPA structure
          mkdir -p Payload
          cp -r Calcme.app Payload/
          # Create IPA file
          zip -r Calcme.ipa Payload
          # List files to verify
          ls -la
    artifacts:
      - Spy-mobile/build/**/*.ipa
      - Spy-mobile/build/**/*.app
      - Spy-mobile/build/**/*.zip
      - Spy-mobile/build/calcme/ios/*.ipa
